<template>
  <div class="tab-container">
    <h3 class="mrg-bot">1. TYPES</h3>
    <el-card class="mrg-top">
      <div class="code-comment mrg-bot">
        åŸºç¡€æ“ä½œï¼šBlockTagã€TopicFilter<br />
        ç½‘ç»œè¿æ¥ï¼šBrowserProviderOptionsã€WebSocketCreator<br />
        äº‹ä»¶ç›‘å¬ï¼šProviderEventã€DebugEventBrowserProvider<br />
        äº¤æ˜“ä¼˜åŒ–ï¼šGasCostParameters<br />
        çŠ¶æ€ç›‘æ§ï¼šOrphanFilter<br />
      </div>
      <typeTable></typeTable>
    </el-card>
    <el-divider />
    <el-divider />
    <h3 class="mrg-bot">2.FUNCTIONS</h3>
    <el-card class="mrg-top">
      <div class="code-comment mrg-bot">
        opyRequest(req: TransactionRequest)â‡’ PreparedTransactionRequest
      </div>
      <el-button class="mrg-bot" type="primary" @click="copyRequestFun">
        copyRequest</el-button
      >
      <div class="code-comment mrg-bot">
        getDefaultProvider(network?: string | Networkish | WebSocketLike,
        options?: any)â‡’ AbstractProvider
      </div>
      <el-button class="mrg-bot" type="primary" @click="getDefaultProviderFun">
        getDefaultProvider</el-button
      >
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">3. class Block</h3>
    <el-card class="mrg-top">
      <h4 class="mrg-bot">PROPERTIES:</h4>
      <blockTable></blockTable>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">4. interface BrowserDiscoverOptions</h3>
    <el-card class="mrg-top">
      <h4 class="mrg-bot">PROPERTIES:</h4>
      <div class="code-comment mrg-bot">
        anyProvider=>boolean <br />
        filterâ‡’ (found: Array<â€‰Eip6963ProviderInfoâ€‰>) => null | BrowserProvider
        | Eip6963ProviderInfo<br />
        providerâ‡’ Eip1193Provider |timeoutâ‡’ number | windowâ‡’ any
      </div>
      <el-button class="mrg-bot" type="primary" @click="setPropertiesFun">
        setProperties</el-button
      >
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">5. class BroeserProvider</h3>
    <el-card class="mrg-top">
      <browserProvider></browserProvider>
    </el-card>
    <el-divider />

    <!-- 6 -->
    <EnsPlugin></EnsPlugin>

    <h3 class="mrg-bot">7. class FeeData</h3>
    <el-card class="mrg-top">
      <FeeData></FeeData>
    </el-card>
    <el-divider />

    <!-- 8/9/10/11 -->
    <Filter></Filter>

    <!-- GasCostPlugin -->
    <h3 class="mrg-bot">12. class CasCostPlugin</h3>
    <el-card class="mrg-top">
      <GasCostPlugin></GasCostPlugin>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">13. class IpcSocketProvider</h3>
    <el-card class="mrg-top">
      <h4 class="mrg-bot">PROPERTIES:</h4>
      <div class="code-comment mrg-bot">socketâ‡’ Socket</div>
      <h4 class="mrg-bot">CREATING INSTANCES :</h4>
      <div class="code-comment mrg-bot">
        new IpcSocketProvider(socket: Socket)â‡’ IpcSocketProvider
      </div>
      <el-button
        class="mrg-bot"
        type="primary"
        @click="newIptSocketProviderFun"
      >
        new IpcSocketProvider</el-button
      >
    </el-card>
    <el-divider />

    <!-- 14 -->
    <logTable></logTable>

    <!-- 15 -->
    <minedBlock></minedBlock>

    <h3 class="mrg-bot">16. class NetworkPlugin</h3>
    <el-card class="mrg-top">
      <networkPlugin></networkPlugin>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">17. class NonceManager</h3>
    <el-card class="mrg-top">
      <nonceManager></nonceManager>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">18. interface Provider</h3>
    <el-card class="mrg-top">
      <Provider></Provider>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">19. interface Signer</h3>
    <el-card class="mrg-top">
      <Signer></Signer>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">20. class TransactionReceipt</h3>
    <el-card class="mrg-top">
      <TransactionReceipt></TransactionReceipt>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">21. class TransactionRequest</h3>
    <el-card class="mrg-top">
      <TransactionRequest></TransactionRequest>
    </el-card>
    <el-divider />

    <h3 class="mrg-bot">22. class TransactionResponse</h3>
    <el-card class="mrg-top">
      <TransactionResponse></TransactionResponse>
    </el-card>
    <el-divider />

    <!-- 18/19 -->
    <webSocket></webSocket>

    <h3 class="mrg-bot">25. Network</h3>
    <el-card class="mrg-top">
      <netWork></netWork>
    </el-card>
    <el-divider />
  </div>
</template>

<script setup lang="ts">
import { ethers } from "ethers";
import { useStore } from "@/store/index";
import typeTable from "./typeTable.vue";
import blockTable from "./blockTable.vue";
import browserProvider from "./browserProvider.vue";
import webSocket from "./webSocket.vue";
import TransactionResponse from "./TransactionResponse.vue";
import TransactionRequest from "./TransactionRequest.vue";
import TransactionReceipt from "./TransactionReceipt.vue";
import Provider from "./Provider.vue";
import Signer from "./Signer.vue";
import netWork from "./netWork.vue";
import nonceManager from "./nonceManager.vue";
import networkPlugin from "./networkPlugin.vue";
import minedBlock from "./mined.vue";
import logTable from "./logTable.vue";
import GasCostPlugin from "./GasCostPlugin.vue";
import Filter from "./Filter.vue";
import FeeData from "./FeeData.vue";
import EnsPlugin from "./EnsPlugin.vue";
const Store = useStore();
const copyRequestFun = () => {
  const request = {
    to: "0x0000000000000000000000000000000000000000",
    value: ethers.parseEther("0.001"),
    gasLimit: 21000,
    gasPrice: ethers.parseUnits("100", "gwei"),
  };
  const _request = ethers.copyRequest(request);
  console.log(_request, "copyRequestFun");
};
const getDefaultProviderFun = () => {
  // Connect to a local Geth node
  const _provider1 = ethers.getDefaultProvider("http://localhost:8545/");
  console.log(_provider1, "copyRequestFun");
  // Connect to Ethereum mainnet with any current and future third-party services available
  const _provider2 = ethers.getDefaultProvider("mainnet");
  console.log(_provider2, "copyRequestFun");
  // Connect to Polygon, but only allow Etherscan and
  // INFURA and use "MY_API_KEY" in calls to Etherscan.
  const _provider3 = ethers.getDefaultProvider("matic", {
    etherscan: "KQJW5N5JVQVZZ1RJ2C4ZC1IQW3E1ZNNSAV",
    exclusive: ["etherscan", "infura"],
  });
  console.log(_provider3, "copyRequestFun");
};
const setPropertiesFun = async () => {
  // const provider = new ethers.BrowserProvider(window.ethereum, {
  //   filter: (providers) => {
  //     // ä¼˜å…ˆé€‰æ‹© Coinbase Wallet
  //     const coinbase = providers.find(p => p.name === 'Coinbase Wallet');
  //     if (coinbase) return coinbase;

  //     // å›é€€åˆ° MetaMask
  //     const metaMask = providers.find(p => p.name === 'MetaMask');
  //     return metaMask || null;
  //   }
  // });
  console.log("setPropertiesFun");
};
const newIptSocketProviderFun = async () => {
  // æ£€æŸ¥ ethers ç‰ˆæœ¬å’Œå¯ç”¨æ€§
  if (!ethers.IpcSocketProvider) {
    console.error("âŒ IpcSocketProvider ä¸å¯ç”¨");
    console.log("ï¿½ï¿½ è¯·æ£€æŸ¥ ethers ç‰ˆæœ¬æˆ–ä½¿ç”¨å…¶ä»– Provider ç±»å‹");
    return;
  }
  // å°è¯•å¸¸è§çš„ IPC è·¯å¾„
  const ipcPaths = [
    "/tmp/geth.ipc", // ä¸´æ—¶ç›®å½•
    "/home/user/.ethereum/geth.ipc", // Linux ç”¨æˆ·ç›®å½•
    "/Users/user/Library/Ethereum/geth.ipc", // macOS
    "\\\\.\\pipe\\geth.ipc", // Windows
  ];

  for (const ipcPath of ipcPaths) {
    try {
      console.log(`ğŸ”Œ å°è¯• IPC è·¯å¾„: ${ipcPath}`);

      const _provider = new ethers.IpcSocketProvider(ipcPath);

      // æµ‹è¯•è¿æ¥
      const network = await _provider.getNetwork();
      const blockNumber = await _provider.getBlockNumber();

      console.log("âœ… IPC è¿æ¥æˆåŠŸï¼");
      console.log("è·¯å¾„:", ipcPath);
      console.log("ç½‘ç»œ:", network.name);
      console.log("é“¾ID:", network.chainId);
      console.log("åŒºå—å·:", blockNumber);

      // å­˜å‚¨åˆ° Store
      // Store.provider = _provider;

      // connected = true;
      break;
    } catch (pathError) {
      console.log(`è·¯å¾„ ${ipcPath} å¤±è´¥:`, pathError.message);
      continue;
    }
  }
};
</script>

<style scoped>
/* é¡µé¢æ ·å¼ */
</style>
